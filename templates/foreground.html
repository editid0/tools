<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% if path == '/foreground' %}Foreground color selector{% else %}Background color selector{% endif %}</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
		/>
	</head>
<body>
    <div class="container">
        <h1 class="title has-text-centered">{% if path == '/foreground' %}Foreground color selector{% else %}Background color selector{% endif %}</h1>
        {% if path == '/foreground' %}
        <p class="has-text-centered">Background color (hex):</p>
        {% else %}
        <p class="has-text-centered">Foreground color (hex):</p>
        {% endif %}
        <div class="field has-addons has-addons-centered">
            <p class="control">
                <a class="button is-static">#</a>
            </p>
            <p class="control">
                <input
                    class="input"
                    type="text"
                    placeholder="FFFFFF"
                    id="hex"
                />
            </p>
        </div>
        <div class="buttons is-centered">
            <button id="submit" class="button is-primary">Submit</button>
        </div>
        <p id="response"></p>
        <div id="options"></div>
    </div>
</body>
<script>
    document.getElementById("hex").addEventListener("input", function () {
        // remove all non hex characters, and any #, remove characters over length 6, and convert to uppercase
        var hex = this.value.replace(/[^0-9A-F]/gi, "").slice(0, 6).toUpperCase();
        // set the value
        this.value = hex;
        // remove trailing #
        hex = hex.replace(/,$/, "");
        // set the value
        document.getElementById("hex").value = hex;
        // remove the is-danger class
        document.getElementById("hex").classList.remove("is-danger");
        // check if hex is valid
        if (/^[0-9A-F]{6}$/i.test(hex)) {
            // do nothing
        } else {
            document.getElementById("hex").classList.add("is-danger");
        }
    })

    document.getElementById("submit").addEventListener("click", function () {
        this.classList.add("is-loading");
        var hex = document.getElementById("hex").value;
        var color = "#" + hex;
        var fgbg = `{% if path == '/foreground' %}foreground{% else %}background{% endif %}`;
        fetch('/colorai?color=' + color + '&fgbg=' + fgbg)
            .then(response => response.json())
            .then(data => {
                document.getElementById("response").innerHTML = data.reason;
                document.getElementById("options").innerHTML = '';
                for (var i = 0; i < data.choices.length; i++) {
                    // create a canvas which will be used to display the color, set the background to the color specified using hex, and add text with color from choice
                    var canvas = document.createElement("canvas");
                    canvas.width = 400;
                    canvas.height = 100;
                    var ctx = canvas.getContext("2d");
                    ctx.fillStyle = color;
                    ctx.fillRect(0, 0, 400, 100);
                    ctx.font = "48px arial";
                    ctx.fillStyle = data.choices[i];
                    ctx.fillText(data.choices[i], 10, 58);
                    document.getElementById("options").appendChild(canvas);
                }
                this.classList.remove("is-loading");
            })
    })
</script>
<style>
    .options {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
</style>
</html>